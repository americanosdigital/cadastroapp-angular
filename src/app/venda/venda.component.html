<div class="card">
  <div class="card-body">
  <h2>Cadastro de Venda</h2>

  <!-- Formulário de Venda -->
  <form #vendaForm="ngForm" (ngSubmit)="onSubmit(vendaForm)">
    <div class="row mb-6">
      <!-- Campo para Número da Venda -->
      <div class="col">
        <label for="numero">Número da Venda</label>
        <input type="text" id="numero" class="form-control" [(ngModel)]="venda.numero" name="numero"  [ngClass]="{ 'editing-field': venda.id }" required />
      </div>
    <!-- Campo para Data de Emissão -->
    <div class="col">
      <label for="dataEmissao">Data de Emissão</label>
      <input type="date" id="dataEmissao" class="form-control" [(ngModel)]="venda.dataEmissao" name="dataEmissao" [ngClass]="{ 'editing-field': venda.id }" required />
    </div>

    <!-- Seleção de Cliente -->
    <div class="col">
      <label for="cliente">cliente</label>
      <select id="cliente" class="form-control" [(ngModel)]="venda.cliente.id" name="cliente" required>
        <option *ngfor="let cliente of clientes" [value]="cliente.id">
          {{ cliente.nome }}
        </option>
      </select>
    </div>

    <!-- Itens da Venda -->
    <div class="form-group mt-4">
      <h4>Itens da Venda</h4>
      <div class="row">
        <div class="col-md-6">
          <label for="produto">Produto</label>
          <select id="produto" class="form-control" [(ngModel)]="venda.produtoId" name="produto" required>
            <option *ngFor="let produto of produtos" [value]="produto.id">
              {{ produto.nome }}
            </option>
          </select>
        </div>

        <div class="col-md-2">
          <label for="quantidade">Quantidade</label>
          <input 
            type="number" 
            id="quantidade" 
            class="form-control" 
            [(ngModel)]="item.quantidade" 
            name="quantidade" 
            min="1" 
            required>
        </div>

        <div class="col-md-2">
          <label for="precoVenda">Preço Venda</label>
          <input 
            type="number" 
            id="precoVenda" 
            class="form-control" 
            [(ngModel)]="item.precoVenda" 
            name="precoVenda" 
            readonly>
        </div>

        <div class="col-md-2">
          <label for="valorTotal">Valor Total</label>
          <input 
            type="number" 
            id="valorTotal" 
            class="form-control" 
            [(ngModel)]="item.valorTotal" 
            name="valorTotal" 
            readonly>
        </div>
      </div>

      <!-- Botão para adicionar item à lista -->
      <button type="button" class="btn btn-primary mt-2" (click)="adicionarItem()">Adicionar Item</button>
    </div>

    <!-- Lista de Itens Adicionados -->
    <div *ngIf="venda.itens.length > 0" class="mt-3">
      <h5>Itens Adicionados</h5>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Produto</th>
            <th>Quantidade</th>
            <th>Preço Venda</th>
            <th>Valor Total</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of venda.itens">
            <td>{{ item.produto.nome }}</td>
            <td>{{ item.quantidade }}</td>
            <td>{{ item.precoVenda | currency:'BRL' }}</td>
            <td>{{ item.valorTotal | currency:'BRL' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Botão para Salvar a Venda -->
    <button type="submit" class="btn btn-success mt-3" [disabled]="!vendaForm.valid || venda.itens.length === 0">Salvar Venda</button>
  </div>
  </form>
</div>
</div>
